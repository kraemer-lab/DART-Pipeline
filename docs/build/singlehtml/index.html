
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>DART Pipeline v0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
</div>
<section id="dart-pipeline">
<h1>DART-Pipeline<a class="headerlink" href="#dart-pipeline" title="Permalink to this headline">¶</a></h1>
<p>The aim of this project is to develop a scalable and reproducible pipeline for the joint analysis of epidemiological, climate, and behavioural data to anticipate and predict dengue outbreaks.</p>
<section id="project-manifest">
<h2>Project Manifest<a class="headerlink" href="#project-manifest" title="Permalink to this headline">¶</a></h2>
<section id="input">
<h3>Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>See <a class="reference external" href="https://unioxfordnexus.sharepoint.com/:x:/r/sites/EngineeringScience-DART/Shared%20Documents/General/DART%20dataset%20summarisation.xlsx?d=w2e772ccb5717440ab47790a6b733a73b&amp;csf=1&amp;web=1&amp;e=Eapex6&amp;nav=MTJfTjNfezAwMDAwMDAwLTAwMDEtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMH0">DART dataset summarisation.xls</a></p></li>
</ul>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>Created using Sphinx.</p>
<p>Generated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ~/DART-Pipeline/docs
$ make singlehtml
</pre></div>
</div>
</section>
</section>
<section id="authors-and-acknowledgments">
<h2>Authors and Acknowledgments<a class="headerlink" href="#authors-and-acknowledgments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>OxRSE</dt><dd><ul>
<li><p>John Brittain</p></li>
<li><p>Rowan Nicholls</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Kraemer Group, Department of Biology</dt><dd><ul>
<li><p>Moritz Kraemer</p></li>
<li><p>Prathyush Sambaturu</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Oxford e-Research Centre, Engineering Science</dt><dd><ul>
<li><p>Sarah Sparrow</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>This section details the usage of all scripts, modules and functions in the pipeline.</p>
<section id="a-collate-data">
<h3>A Collate Data<a class="headerlink" href="#a-collate-data" title="Permalink to this headline">¶</a></h3>
<p>The “A Collate Data” folder contains one script - <cite>collate_data.py</cite> - which will be documented here:</p>
<section id="module-collate_data">
<span id="collate-data-py"></span><h4>collate_data.py<a class="headerlink" href="#module-collate_data" title="Permalink to this headline">¶</a></h4>
<p>Script to collate raw data by downloading it from online sources.</p>
<p>See “DART dataset summarisation.xls” for information about the data fields
to be collated.</p>
<p>This documentation assumes Python 3.12 is being used. Other versions have not
been tested.</p>
<p>Package requirements for this script are listed in <cite>requirements.txt</cite> as
created with <cite>pipreqs</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3.12 -m pip install pipreqs
$ pipreqs &#39;.&#39; --force
</pre></div>
</div>
<p>These packages can be installed from the terminal via the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3.12 -m pip install requests
$ python3.12 -m pip install lxml
$ python3.12 -m pip install cdsapi
$ python3.12 -m pip install setuptools
$ python3.12 -m pip install pandas
$ python3.12 -m pip install py7zr
$ python3.12 -m pip install passpy
$ python3.12 -m pip install setuptools
</pre></div>
</div>
<p>Password management is done with gnupg (aka gnupg2, <a class="reference external" href="mailto:gnupg&#37;&#52;&#48;2&#46;4">gnupg<span>&#64;</span>2<span>&#46;</span>4</a>, gpg, gpg2):</p>
<ul class="simple">
<li><p>Setup on Ubuntu:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3.12 -m pip install passpy
$ sudo apt-get install gnupg2 -y
$ sudo apt install pass
$ gpg --gen-key
$ gpg --list-keys
$ cd ~/DART-Pipeline
$ export PASSWORD_STORE_DIR=$PWD/.password-store
$ pass init &lt;your GPG public key&gt;
$ passpy insert &quot;name for password&quot;
$ passpy show &quot;name for password&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>Setup on macOS:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3.12 -m pip install passpy
$ brew install gnupg
$ brew install pass
$ gpg --gen-key
$ gpg --list-keys
$ cd ~/DART-Pipeline
$ export PASSWORD_STORE_DIR=$PWD/.password-store
$ pass init &lt;your GPG public key&gt;
$ passpy insert &quot;name for password&quot;
$ passpy show &quot;name for password&quot;
</pre></div>
</div>
<p>If you see <cite>OSError: Unable to run gpg (gpg2) - it may not be available.</cite> then
it might mean you haven’t installed gpg or it might mean that macOS can’t find
it. My solution is to use it from within Python, not from the Terminal.</p>
<hr class="docutils" />
<dl class="py function">
<dt class="sig sig-object py" id="collate_data.get_base_directory">
<span class="sig-prename descclassname"><span class="pre">collate_data.</span></span><span class="sig-name descname"><span class="pre">get_base_directory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#collate_data.get_base_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the base directory for a Git project.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em><em> or </em><em>pathlib.Path</em><em>, </em><em>default '.'</em>) – The path to the child directory.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The path to the parent/grand-parent/etc directory of the child
directory that contains the “.git” folder. If no such directory exists,
returns None.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str or pathlib.Path, or None</p>
</dd>
</dl>
</dd></dl>

<hr class="docutils" />
<dl class="py function">
<dt class="sig sig-object py" id="collate_data.get_password">
<span class="sig-prename descclassname"><span class="pre">collate_data.</span></span><span class="sig-name descname"><span class="pre">get_password</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#collate_data.get_password" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a password from a passpy store.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_name</strong> (<em>str</em>) – Name of the field that is accessible online but which is
password-protected.</p></li>
<li><p><strong>username</strong> (<em>str</em>) – The username associated with an account that can access the data.</p></li>
<li><p><strong>base_dir</strong> (<em>str</em><em> or </em><em>pathlib.Path</em><em>, </em><em>default '.'</em>) – The base directory of the Git project. It is assumed that the password
store has been created and is located here.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>password</strong> – If successful, the password associated with the entry in the password
store will be returned.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<hr class="docutils" />
<dl class="py function">
<dt class="sig sig-object py" id="collate_data.walk">
<span class="sig-prename descclassname"><span class="pre">collate_data.</span></span><span class="sig-name descname"><span class="pre">walk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relative_url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_one</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">username</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#collate_data.walk" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-create <cite>os.walk</cite> and <cite>Path.walk</cite> for use with a website.</p>
<p>By default, all the files that are encountered by this walk function will
be downloaded into a matching file structure on the local machine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_url</strong> (<em>str</em>) – The base URL of the website being accessed.</p></li>
<li><p><strong>relative_url</strong> (<em>str</em>) – The base_url plus the relative_url points to the folder on the server
that will act as the starting point for the walk.</p></li>
<li><p><strong>only_one</strong> (<em>bool</em><em>, </em><em>default False</em>) – If True, only one file from each folder on the remote server will be
downloaded (if <cite>dry_run=True</cite> it will not be downloaded but an empty
file will created to represent it). This is to save on time and space
when testing functionality.</p></li>
<li><p><strong>dry_run</strong> (<em>bool</em><em>, </em><em>default False</em>) – If True, the data will be downloaded. If False, no data will be
downloaded but, instead, empty files will be created in the output
folder with a naming system matching that of a wet run.</p></li>
<li><p><strong>out_dir</strong> (<em>str</em><em>, </em><em>default '.'</em>) – The folder to which the data will be downloaded.</p></li>
<li><p><strong>username</strong> (<em>str</em><em>, </em><em>default None</em>) – The username associated with an account that can access the data.</p></li>
<li><p><strong>password</strong> (<em>str</em><em>, </em><em>default None</em>) – The password associated with an account that can access the data.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<hr class="docutils" />
<dl class="py function">
<dt class="sig sig-object py" id="collate_data.download_worldpop_data">
<span class="sig-prename descclassname"><span class="pre">collate_data.</span></span><span class="sig-name descname"><span class="pre">download_worldpop_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alias_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alias_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#collate_data.download_worldpop_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Download data from www.worldpop.org.</p>
<p>A summary of all the available data can be downloaded by running
<cite>collate_data.py</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>out_dir</strong> (<em>str</em><em> or </em><em>pathlib.Path</em>) – Path to the folder to where the data will be downloaded.</p></li>
<li><p><strong>alias_1</strong> (<em>str</em>) – The macro data type’s ‘alias’ as used by the World Pop website.</p></li>
<li><p><strong>name_1</strong> (<em>str</em>) – The macro data type’s ‘name’ as used by the World Pop website.</p></li>
<li><p><strong>alias_2</strong> (<em>str</em>) – The mico data type’s ‘alias’ as used by the World Pop website.</p></li>
<li><p><strong>name_2</strong> (<em>str</em>) – The mico data type’s ‘name’ as used by the World Pop website.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<hr class="docutils" />
<dl class="py function">
<dt class="sig sig-object py" id="collate_data.download_gadm_data">
<span class="sig-prename descclassname"><span class="pre">collate_data.</span></span><span class="sig-name descname"><span class="pre">download_gadm_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_format</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iso3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'VNM'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#collate_data.download_gadm_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Download and unpack data from GADM.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_format</strong> (<em>{'Geopackage'</em><em>, </em><em>'Shapefile'</em><em>, </em><em>'GeoJSON'}</em>) – The format of the raw data to be downloaded.</p></li>
<li><p><strong>out_dir</strong> (<em>str</em><em> or </em><em>pathlib.Path</em>) – Folder path to where the files will be downloaded.</p></li>
<li><p><strong>iso3</strong> (<em>str</em><em>, </em><em>default 'VNM'</em><em>,</em>) – Alpha-3 country code as per ISO 3166 for the desired country. List of
country codes:
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes">https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes</a></p></li>
<li><p><strong>level</strong> (<em>{'level0'</em><em>, </em><em>'level1'</em><em>, </em><em>'level2'</em><em>, </em><em>'level3'</em><em>, </em><em>None}</em><em>, </em><em>default None</em>) – <p>Administrative levels available (depends on the country):</p>
<ul>
<li><p>level 0: country</p></li>
<li><p>level 1: state (province)</p></li>
<li><p>level 2: county (district)</p></li>
<li><p>level 3: commune/ward (and equivalents)</p></li>
</ul>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="b-process-data">
<h3>B Process Data<a class="headerlink" href="#b-process-data" title="Permalink to this headline">¶</a></h3>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">DART Pipeline</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Rowan Nicholls and Prathyush Sambaturu.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>